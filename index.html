<!doctype html>
<html>

<head>
    <title>3D Test</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .latlong-box {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.6);
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
        }
        video {
            width: 100%;
            height: 100vh;
            object-fit: cover;
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
        }
        model-viewer {
            width: 100%;
            height: 500px;
        }
    </style>
</head>

<body>
    <div class="latlong-box" id="latlong">Lat: -- , Lng: --</div>

    <video autoplay playsinline id="videoElement"></video>

    <div id="model">
        <model-viewer id="model1" class="modelviewer" 
            camera-controls 
            touch-action="pan-y" 
            src="/WaterBottle.glb" 
            tone-mapping="commerce" 
            ar 
            alt="Please wait while the model is loading..."
            style="background-color: unset;">
        </model-viewer>
    </div>

    <!-- Loads model-viewer for modern browsers -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.js"></script>
    <!-- Loads model-viewer for older browsers -->
    <script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script>

    <script>
        // === CAMERA (Back camera) ===
        const video = document.querySelector("#videoElement");

        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({
                video: { facingMode: { exact: "environment" } } // back camera
            })
            .then(function (stream) {
                video.srcObject = stream;
            })
            .catch(function (error) {
                console.log("Camera error:", error);
                alert("Camera not supported on this device/browser.");
            });
        } else {
            alert("Camera not supported on this device/browser.");
        }

        // === LOCATION ===
        if ("geolocation" in navigator) {
            navigator.geolocation.watchPosition(function (position) {
                var latitude = position.coords.latitude.toFixed(6);
                var longitude = position.coords.longitude.toFixed(6);

                // Show live lat/long
                document.getElementById("latlong").innerText = 
                    "Lat: " + latitude + " , Lng: " + longitude;

                // Example: check with reference location
                const refLatArray = [26.2708944];
                const refLongArray = [73.040275];

                for (let i = 0; i < 1; i++) {
                    const refLat = refLatArray[i];
                    const refLong = refLongArray[i];
                    const modelID = 'model' + (i + 1);

                    if (Math.abs(latitude - refLat) < 0.00009 &&
                        Math.abs(longitude - refLong) < 0.00009) {
                        setDisplay(modelID, 'block');
                    } else {
                        setDisplay(modelID, 'none');
                    }
                }
            }, function (error) {
                alert("Error getting location. Please allow GPS access.");
            });
        } else {
            alert("Geolocation not available on this device.");
        }

        function setDisplay(modelID, propValue) {
            var div = document.getElementById(modelID);
            if (div) div.style.display = propValue;
        }
    </script>

</body>
</html>
